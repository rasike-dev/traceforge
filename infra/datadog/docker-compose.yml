services:
  datadog-agent:
    image: gcr.io/datadoghq/agent:7
    container_name: traceforge-datadog-agent
    environment:
      # REQUIRED
      - DD_API_KEY=${DD_API_KEY}
      - DD_SITE=${DD_SITE:-datadoghq.com}

      # Nice defaults
      - DD_ENV=dev
      - DD_SERVICE=traceforge-api
      - DD_VERSION=0.1.0

      # APM enabled (good even if you're using OTLP)
      - DD_APM_ENABLED=true
      - DD_APM_NON_LOCAL_TRAFFIC=true

      # âœ… Enable OTLP ingest (HTTP) on 4318
      - DD_OTLP_CONFIG_RECEIVER_PROTOCOLS_HTTP_ENDPOINT=0.0.0.0:4318

      # (Optional) Enable OTLP logs ingest (keep OFF unless you want logs billing)
      # - DD_LOGS_ENABLED=true
      # - DD_OTLP_CONFIG_LOGS_ENABLED=true

      # Workaround for a known Docker OTLP ingest pipeline issue in some Agent versions:
      - HOST_PROC=/proc
    ports:
      # OTLP/HTTP
      - "4318:4318"
      # APM intake (optional but handy)
      - "8126:8126"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /proc/:/host/proc/:ro
      - /sys/fs/cgroup/:/host/sys/fs/cgroup:ro

